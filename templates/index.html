<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Your Decks</title>
    <!-- Include SweetAlert2 (for the confirmation alert) and htmx -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  </head>
  <body>
    <h1>Decks</h1>
    <h2>Create a New Deck</h2>
    <form action="/decks" method="post">
      <input type="text" name="name" placeholder="Deck Name" required>
      <button type="submit">Create</button>
    </form>

    <ul>
      {{range .decks}}
      <li id="deck-{{.ID}}">
        <a href="/decks/{{.ID}}">{{.Name}}</a>
        <!-- The edit button now uses hx-get to hit an edit endpoint.
It looks for a click event. We also assign an onClick handler to check for in-progress edits. -->
        <button
          type="button"
          hx-get="/decks/{{.ID}}/edit"
          hx-target="closest li"
          hx-swap="outerHTML"
          onClick="handleEditClick(this)"
        >Edit</button>
        <button 
          type="button"
          hx-delete="/decks/{{.ID}}"
          hx-target="closest li"
          hx-swap="outerHTML swap:1s"
        >
          Delete
        </button>
      </li>
      {{else}}
      <li>No decks found.</li>
      {{end}}
    </ul>

    <script>
    function handleEditClick(button) {
      // Check if there is already an element with the "editing" class.
      var editing = document.querySelector('.editing');
      if(editing) {
        Swal.fire({
          title: 'Already Editing',
          text: 'Hey! You are already editing a row! Do you want to cancel that edit and continue?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, edit this row!'
        }).then((result) => {
            if(result.isConfirmed) {
              // Trigger a custom "cancel" event on the editing row.
              htmx.trigger(editing, 'cancel');
              // Now trigger the original click event.
              htmx.trigger(button, 'click');
            }
          });
        // Prevent further processing until the user has made a decision.
        return false;
      }
      // Otherwise, allow the click to do its normal htmx-get action.
    }
    </script>
  </body>
</html>
